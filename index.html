<!doctype html>
<html lang="de">
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Tims Socken Countdown</title>
	<canvas id="snow" aria-hidden="true"></canvas>
	<div>
		<img src="./socks.png" alt="Gehäkelte Socken" class="hero" loading="lazy" decoding="async">
		<div id="count" class="count">--d --h --m --s</div>
		<div class="t">Bis du meine Socken fertig gehäkelt hast. &#128578;</div>
		<div class="t" style="margin-top: 25px">Frohe Weihnachten! &#x1F384;</div>
	</div>
</html>

<script>
(() => {
	const el = document.getElementById('count'), pad=n=>String(n).padStart(2,'0');
	let y=new Date().getFullYear();
	let target=new Date(`${y}-12-24T18:00:00+01:00`);
	if (new Date() > target) target=new Date(`${y+1}-12-24T18:00:00+01:00`);
	function tick(){
		const d=target-new Date(); if(d<=0){ el.textContent='Frohe Weihnachten!'; clearInterval(t); return; }
		const s=Math.floor(d/1000), dd=Math.floor(s/86400),
			h=Math.floor((s%86400)/3600), m=Math.floor((s%3600)/60), sec=s%60;
		el.textContent = `${dd}d ${pad(h)}h ${pad(m)}m ${pad(sec)}s`;
	}
	tick(); const t=setInterval(tick,1000);
})();

(() => {
	const c = document.getElementById('snow');
	const ctx = c.getContext('2d');
	const DPR = Math.min(window.devicePixelRatio || 1, 2);
	let W, H, flakes = [];

	function resize() {
		W = innerWidth;
		H = innerHeight;
		c.width  = W * DPR;
		c.height = H * DPR;
		c.style.width  = W + 'px';
		c.style.height = H + 'px';
		ctx.scale(DPR, DPR);
	}
	addEventListener('resize', resize, { passive: true });
	resize();

	const N = innerWidth < 420 ? 60 : 120;

	function resetFlake(f) {
		f.x = Math.random() * W;
		f.y = -10;
		f.r = Math.random() * 2 + 1;
		f.vy = Math.random() * 0.8 + 0.4; // Geschwindigkeit Y
		f.vx = Math.random() * 0.6 - 0.3; // leichtes seitliches Driften
		f.alpha = Math.random() * 0.5 + 0.5;
	}

	flakes = Array.from({ length: N }, () => {
		const f = {};
		resetFlake(f);
		f.y = Math.random() * H; // verteilt starten
		return f;
	});

	function tick() {
		ctx.clearRect(0, 0, W, H);
		ctx.fillStyle = "#fff";
		for (const f of flakes) {
			f.x += f.vx;
			f.y += f.vy;
			if (f.y > H + 5 || f.x < -5 || f.x > W + 5) resetFlake(f);
			ctx.globalAlpha = f.alpha;
			ctx.beginPath();
			ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
			ctx.fill();
		}
		ctx.globalAlpha = 1;
		requestAnimationFrame(tick);
	}

	const m = matchMedia("(prefers-reduced-motion: reduce)");
	if (!m.matches) requestAnimationFrame(tick);
})();
</script>

<style>
	html,body{
		height: 90%;
		margin: 0;
	}
	
	body > div { position: relative; z-index: 1; }


	#snow{
	  position: fixed; inset: 0;
	  pointer-events: none;
	  z-index: 0;
	}
	
	body{
		background: #000;
		color: #fff;
		display: grid;
		place-items: center;
		text-align: center;
		font: 600 2rem/1.2 system-ui,sans-serif;
	}
  
	.t{
		opacity: .85;
		font-weight: 400;
		font-size: clamp(1rem,2.5vw,1.5rem);
	}
	
	.count{
		font: 700 clamp(2rem,6vw,6rem) ui-monospace,monospace
	}

	.hero{
		display: block;
		margin: 1rem auto 0;
		margin-bottom: 20px;
		max-width: min(300px,60vw);
		height: auto;
		border-radius: 20px;
		box-shadow: 0 6px 20px rgba(0,0,0,.35);
	}
</style>
